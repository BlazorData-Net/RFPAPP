@using RFPResponsePOC.Models
@using RFPResponsePOC.Client.Models

@inject DialogService DialogService

<EditForm Model="Room" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <RadzenTabs>
        <Tabs>
            <RadzenTabsItem Text="Room Details">
                <div style="margin: 20px 0; display: flex; gap: 20px;">
                    <label for="name">Name</label>
                    <RadzenTextBox id="name" @bind-Value="Room.Name" Style="width: 100%;" />
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="squareFeet">Square Feet</label>
                        <RadzenNumeric id="squareFeet" @bind-Value="Room.SquareFeet" Style="width: 100%;" />
                    </div>

                    <div class="form-group">
                        <label for="length">Length</label>
                        <RadzenNumeric id="length" @bind-Value="Room.Length" Style="width: 100%;" />
                    </div>

                    <div class="form-group">
                        <label for="width">Width</label>
                        <RadzenNumeric id="width" @bind-Value="Room.Width" Style="width: 100%;" />
                    </div>

                    <div class="form-group">
                        <label for="ceilingHeight">Ceiling Height</label>
                        <RadzenNumeric id="ceilingHeight" @bind-Value="Room.CeilingHeight" Style="width: 100%;" />
                    </div>
                </div>

                <div class="form-group">
                    <label for="floorLevel">Floor Level</label>
                    <RadzenTextBox id="floorLevel" @bind-Value="Room.FloorLevel" Style="width: 100%;" />
                </div>

                <div style="margin: 20px 0; display: flex; gap: 20px;">
                    <div class="form-group" style="flex: 1;">
                        <label for="hasNaturalLight">Natural Light</label>
                        <RadzenSwitch id="hasNaturalLight" @bind-Value="HasNaturalLight" />
                    </div>

                    <div class="form-group" style="flex: 1;">
                        <label for="hasPillars">Has Pillars</label>
                        <RadzenSwitch id="hasPillars" @bind-Value="HasPillars" />
                    </div>
                </div>

                <div class="form-group">
                    <label for="groupDropdown">Room Group</label>
                    <RadzenDropDown @bind-Value="Room.RoomGroup"
                                    Data="RoomNamesForGroupDropdown" 
                                    TValue="string"
                                    TextProperty=""
                                    ValueProperty=""
                                    Placeholder="-- Select Room Group --" 
                                    Style="width: 100%;" 
                                    AllowClear="true" />
                </div>
            </RadzenTabsItem>

            <RadzenTabsItem Text="Capacities">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="banquet">Banquet</label>
                        <RadzenNumeric id="banquet" @bind-Value="Room.Capacities.Banquet" Style="width: 100%;" />
                    </div>
                    <div class="form-group">
                        <label for="conference">Conference</label>
                        <RadzenNumeric id="conference" @bind-Value="Room.Capacities.Conference" Style="width: 100%;" />
                    </div>
                    <div class="form-group">
                        <label for="square">Square</label>
                        <RadzenNumeric id="square" @bind-Value="Room.Capacities.Square" Style="width: 100%;" />
                    </div>
                    <div class="form-group">
                        <label for="reception">Reception</label>
                        <RadzenNumeric id="reception" @bind-Value="Room.Capacities.Reception" Style="width: 100%;" />
                    </div>
                    <div class="form-group">
                        <label for="schoolRoom">School Room</label>
                        <RadzenNumeric id="schoolRoom" @bind-Value="Room.Capacities.SchoolRoom" Style="width: 100%;" />
                    </div>
                    <div class="form-group">
                        <label for="theatre">Theatre</label>
                        <RadzenNumeric id="theatre" @bind-Value="Room.Capacities.Theatre" Style="width: 100%;" />
                    </div>
                    <div class="form-group">
                        <label for="uShape">U-Shape</label>
                        <RadzenNumeric id="uShape" @bind-Value="Room.Capacities.UShape" Style="width: 100%;" />
                    </div>
                    <div class="form-group">
                        <label for="hollowSquare">Hollow Square</label>
                        <RadzenNumeric id="hollowSquare" @bind-Value="Room.Capacities.HollowSquare" Style="width: 100%;" />
                    </div>
                    <div class="form-group">
                        <label for="boardroom">Boardroom</label>
                        <RadzenNumeric id="boardroom" @bind-Value="Room.Capacities.Boardroom" Style="width: 100%;" />
                    </div>
                    <div class="form-group">
                        <label for="crescentRounds">Crescent Rounds</label>
                        <RadzenNumeric id="crescentRounds" @bind-Value="Room.Capacities.CrescentRounds" Style="width: 100%;" />
                    </div>
                </div>
            </RadzenTabsItem>
        </Tabs>
    </RadzenTabs>

    <div style="margin-top: 20px;">
        <RadzenButton Text="Save" ButtonStyle="ButtonStyle.Primary" ButtonType="ButtonType.Submit" />
        <RadzenButton Text="Delete" ButtonStyle="ButtonStyle.Danger" Click="ConfirmDelete" />
        <RadzenButton Text="Cancel" ButtonStyle="ButtonStyle.Light" Click="Cancel" />
    </div>
</EditForm>

@code {
    [Parameter] public Room Room { get; set; }
    [Parameter] public List<Room> AllRooms { get; set; } // Pass all rooms to this dialog

    private List<string> RoomNamesForGroupDropdown => 
        AllRooms?   
            .Where(r => !string.IsNullOrWhiteSpace(r.Name) && r.Name != Room.Name)
            .Select(r => r.Name)
            .Distinct()
            .OrderBy(n => n)
            .ToList()
        ?? new List<string>();

    private bool HasNaturalLight
    {
        get => Room.HasNaturalLight ?? false;
        set => Room.HasNaturalLight = value;
    }

    private bool HasPillars
    {
        get => Room.HasPillars ?? false;
        set => Room.HasPillars = value;
    }

    private void HandleValidSubmit()
    {
        DialogService.Close(new EditRoomDialogResult { IsDeleted = false, Room = Room });
    }

    private async Task ConfirmDelete()
    {
        var confirm = await DialogService.Confirm("Are you sure you want to delete this room?", "Confirm Delete");
        if (confirm == true)
        {
            DialogService.Close(new EditRoomDialogResult { IsDeleted = true, Room = Room });
        }
    }

    private void Cancel()
    {
        DialogService.Close(null);
    }
}